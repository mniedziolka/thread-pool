<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Thread pool: Thread-pool</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Thread pool
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Thread-pool </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This library contains the thread-pool and future mechanism (known from C++ std::future) implemented in C.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Details of thread-pool</h1>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="threadpool_8c.html#a90f92768867b93ed820bf6a77c46826e">thread_pool_init</a>(<a class="code" href="structthread__pool.html">thread_pool_t</a> *pool, <span class="keywordtype">size_t</span> pool_size);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="threadpool_8c.html#a059d907b83c6a0da6c428ea0d63ace8f">thread_pool_destroy</a>(<a class="code" href="structthread__pool.html">thread_pool_t</a> *pool);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="threadpool_8c.html#a14b2cd15dd8c604554330fd71061d277">defer</a>(<a class="code" href="structthread__pool.html">thread_pool_t</a> *pool, <a class="code" href="structrunnable.html">runnable_t</a> <a class="code" href="structrunnable.html">runnable</a>);</div>
</div><!-- fragment --><p>The thread_pool_init call initiates the argument pointed to by pool as the new pool in which it will have pool_size of serving threads to complete the task. Library correctness is only guaranteed if each pool created by thread_pool_init is destroyed by calling thread_pool_destroy with an argument representing these pools.</p>
<p>A call to defer(pool, runnable) instructs the pool to execute the task described by the argument runnable. Function arguments are passed by the args pointer. In the args field there is the length of the buffer available for writing and reading located under this pointer.</p>
<p>The tasks commissioned by defer are concurrent and independent of each other as far as it's possible. Pool size is the limit of concurrent tasks. The pot during its operation no should have more threads than specified by the pool_size parameter. Created threads are kept alive until thread_pool_destroy.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Details of the future mechanism</h1>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="future_8c.html#a497eeb643290a2751920f399299fd819">async</a>(<a class="code" href="structthread__pool.html">thread_pool_t</a>* pool, <a class="code" href="structfuture.html">future_t</a> *<a class="code" href="structfuture.html">future</a>, <a class="code" href="structcallable.html">callable_t</a> <a class="code" href="structcallable.html">callable</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="future_8c.html#a72fc670838567eda4e7290d109131ebf">map</a>(<a class="code" href="structthread__pool.html">thread_pool_t</a>* pool, <a class="code" href="structfuture.html">future_t</a>* <a class="code" href="structfuture.html">future</a>, <a class="code" href="structfuture.html">future_t</a>* from,</div>
<div class="line">        <span class="keywordtype">void</span>* (*<span class="keyword">function</span>)(<span class="keywordtype">void</span>*, <span class="keywordtype">size_t</span>, <span class="keywordtype">size_t</span>*));</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span>* <a class="code" href="future_8c.html#ad631343c9f48fb1877318ea31a16dec1">await</a>(<a class="code" href="structfuture.html">future_t</a> *<a class="code" href="structfuture.html">future</a>);</div>
</div><!-- fragment --><p>Running async initializes memory for future, assigns callable to calculate the value in the pool and returns it to future mechanism.</p>
<p>User can now:</p>
<ul>
<li>Wait for value to be calculated: <div class="fragment"><div class="line"><span class="keywordtype">void</span>* result = <a class="code" href="future_8c.html#ad631343c9f48fb1877318ea31a16dec1">await</a>(future_value);</div>
</div><!-- fragment --></li>
<li>Use some pool to calculate next future using previous one. <div class="fragment"><div class="line">err = <a class="code" href="future_8c.html#a72fc670838567eda4e7290d109131ebf">map</a>(pool2, mapped_value, future_value, function2);</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Details of matrix.c</h1>
<p>This is the program that uses the thread-pool to calculate the row-sums in matrix. The first two lines contain two numbers k and n (number of rows and columns). Then the program should read k*n lines with data. Every line contains two numbers v and t. Number v in line i (number of row is defined by calculating floor(i/n)) specify the value. Number t specify the time (in milliseconds) needed for calculating the v value. Here is the example of correct input data: </p><div class="fragment"><div class="line">2</div>
<div class="line">3</div>
<div class="line">1 2</div>
<div class="line">1 5</div>
<div class="line">12 4</div>
<div class="line">23 9</div>
<div class="line">3 11</div>
<div class="line">7 2</div>
</div><!-- fragment --><p>Input date above represents matrix below. </p><div class="fragment"><div class="line">|  1  1 12 |</div>
<div class="line">| 23  3  7 |</div>
</div><!-- fragment --><p>Running the program:</p>
<div class="fragment"><div class="line">$ cat data1.dat | ./macierz</div>
</div><!-- fragment --><p>should have the same result as stated below </p><div class="fragment"><div class="line">14</div>
<div class="line">33</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Details of factorial.c</h1>
<p>This is the program that will calculate the n! value using three threads and future mechanism: Running: </p><div class="fragment"><div class="line">$ echo 5 | ./silnia</div>
</div><!-- fragment --><p>should result with </p><div class="fragment"><div class="line">120</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Compiling</h1>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
</div><!-- fragment --><p>Should compile the library to build/libasyncc.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Running tests</h1>
<p>You can run tests by</p>
<div class="fragment"><div class="line">make test</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="astructrunnable_html"><div class="ttname"><a href="structrunnable.html">runnable</a></div><div class="ttdoc">Runnable function.</div><div class="ttdef"><b>Definition:</b> threadpool.h:20</div></div>
<div class="ttc" id="athreadpool_8c_html_a90f92768867b93ed820bf6a77c46826e"><div class="ttname"><a href="threadpool_8c.html#a90f92768867b93ed820bf6a77c46826e">thread_pool_init</a></div><div class="ttdeci">int thread_pool_init(thread_pool_t *pool, size_t num_threads)</div><div class="ttdoc">Initialize the thread-pool.</div><div class="ttdef"><b>Definition:</b> threadpool.c:185</div></div>
<div class="ttc" id="astructthread__pool_html"><div class="ttname"><a href="structthread__pool.html">thread_pool</a></div><div class="ttdoc">Thread-pool.</div><div class="ttdef"><b>Definition:</b> threadpool.h:46</div></div>
<div class="ttc" id="astructcallable_html"><div class="ttname"><a href="structcallable.html">callable</a></div><div class="ttdoc">Callable function.</div><div class="ttdef"><b>Definition:</b> future.h:17</div></div>
<div class="ttc" id="afuture_8c_html_ad631343c9f48fb1877318ea31a16dec1"><div class="ttname"><a href="future_8c.html#ad631343c9f48fb1877318ea31a16dec1">await</a></div><div class="ttdeci">void * await(future_t *future)</div><div class="ttdoc">Wait for future to finish.</div><div class="ttdef"><b>Definition:</b> future.c:100</div></div>
<div class="ttc" id="afuture_8c_html_a72fc670838567eda4e7290d109131ebf"><div class="ttname"><a href="future_8c.html#a72fc670838567eda4e7290d109131ebf">map</a></div><div class="ttdeci">int map(thread_pool_t *pool, future_t *future, future_t *from, void *(*function)(void *, size_t, size_t *))</div><div class="ttdoc">Create a future variable that will store the result of callable.</div><div class="ttdef"><b>Definition:</b> future.c:68</div></div>
<div class="ttc" id="afuture_8c_html_a497eeb643290a2751920f399299fd819"><div class="ttname"><a href="future_8c.html#a497eeb643290a2751920f399299fd819">async</a></div><div class="ttdeci">int async(thread_pool_t *pool, future_t *future, callable_t callable)</div><div class="ttdoc">Create a future variable that will store the result of callable.</div><div class="ttdef"><b>Definition:</b> future.c:50</div></div>
<div class="ttc" id="athreadpool_8c_html_a059d907b83c6a0da6c428ea0d63ace8f"><div class="ttname"><a href="threadpool_8c.html#a059d907b83c6a0da6c428ea0d63ace8f">thread_pool_destroy</a></div><div class="ttdeci">void thread_pool_destroy(thread_pool_t *pool)</div><div class="ttdoc">Destroy the thread-pool.</div><div class="ttdef"><b>Definition:</b> threadpool.c:256</div></div>
<div class="ttc" id="astructfuture_html"><div class="ttname"><a href="structfuture.html">future</a></div><div class="ttdoc">Future that will get the value asynchronously (similar to C++ std::future).</div><div class="ttdef"><b>Definition:</b> future.h:27</div></div>
<div class="ttc" id="athreadpool_8c_html_a14b2cd15dd8c604554330fd71061d277"><div class="ttname"><a href="threadpool_8c.html#a14b2cd15dd8c604554330fd71061d277">defer</a></div><div class="ttdeci">int defer(struct thread_pool *pool, runnable_t runnable)</div><div class="ttdoc">Add a new task to the pool.</div><div class="ttdef"><b>Definition:</b> threadpool.c:318</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Feb 13 2020 11:43:31 for Thread pool by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
